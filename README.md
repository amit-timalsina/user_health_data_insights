# Rolling Insights - 7-Day Health Analytics

A tool that analyzes 7 consecutive days of health data to generate insights on sleep patterns, phone usage, and health metrics.

## Installation

```bash
git clone <repository-url>
cd rolling-insights
```

Make a virtual env. Then,
```bash
pip install -r requirements.txt
```

## Usage

Run the script to generate insights:

```bash
python build_insights.py
```

This processes the data in `samples/` and outputs three JSON files to the `insights/` directory:
- `sleepInsights.json` - Analysis of deep sleep, REM, efficiency, and latency
- `phoneUsage.json` - Screen time, pickups, and sleep impact analysis
- `healthInsights.json` - Vitals, activity load, and recovery analysis

## LLM Method

This project uses OpenAI's API to generate narrative insights. The system:
1. Extracts and calculates statistics from raw health data
2. Identifies correlations between metrics
3. Sends these statistics to the LLM with specialized prompts
4. Formats the responses into meaningful insights

Environment variables for LLM integration:
```
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-4o-mini  # Optional, defaults to gpt-4o-mini
```

## Project Structure

```
rolling_insights/        # Main package
├── models/              # Data schemas
├── analytics/           # Statistical processing
├── services/            # Business logic
├── exceptions/          # Error handling
build_insights.py        # Main script
requirements.txt         # Dependencies
```

## Features

- Processes 7 consecutive nights of health data
- Outputs three insight payloads:
  - `sleepInsights.json` - Deep sleep, REM, efficiency, latency analysis
  - `phoneUsage.json` - Screen time, pickups, overlap analysis
  - `healthInsights.json` - Vitals, activity load, recovery analysis
- AI-generated narrative insights using OpenAI's GPT models
- Hybrid architecture implementation for maintainability and intuitive organization

## Architecture

This project follows a hybrid architecture that combines intuitive naming with clean architecture principles:

1. **Models** - Core data structures using Pydantic
   - Located in `rolling_insights/models/`
   - Contains schema definitions with validation

2. **Analytics** - Statistical calculations and algorithms
   - Located in `rolling_insights/analytics/`
   - Pure functions for data analysis

3. **Services** - Business logic coordination
   - Located in `rolling_insights/services/`
   - Orchestrates the flow between models, analytics, and external services

4. **External** - Interface adapters for external systems
   - Located in `rolling_insights/external/`
   - Handles AI services and storage operations

5. **Utils** - Common utilities and helpers
   - Located in `rolling_insights/utils/`
   - Reusable functions used across the application

6. **Exceptions** - Custom error types
   - Located in `rolling_insights/exceptions/`
   - Specialized error classes for better error handling

This hybrid approach makes the codebase:
- More intuitive for new developers
- Better organized by logical function
- Still maintainable with proper separation of concerns

## Output Samples

Each generated insight file contains:
- Period information (start/end date)
- Statistical metrics
- Daily data points
- Narrative insights generated by AI

Example of sleepInsights.json:
```json
{
  "period": {
    "start_date": "2025-03-24",
    "end_date": "2025-03-30"
  },
  "stats": {
    "avg_total_sleep_minutes": 451.71,
    "avg_deep_sleep_minutes": 135.57,
    "avg_rem_sleep_minutes": 90.29,
    "avg_light_sleep_minutes": 225.86,
    "avg_sleep_efficiency": 0.92,
    "min_total_sleep_minutes": 420,
    "max_total_sleep_minutes": 510,
    "deep_sleep_percentage": 30.01,
    "rem_sleep_percentage": 19.99,
    "light_sleep_percentage": 50.00
  },
  "daily_data": [...],
  "narrative_insights": "Your deep sleep duration of 135 minutes per night exceeds the adult average of 90 minutes, suggesting excellent slow-wave sleep that contributes to memory consolidation and cellular repair. Your sleep efficiency of 92% is exceptional, indicating minimal disruptions once asleep..."
}
```

## License

[MIT License](LICENSE) 